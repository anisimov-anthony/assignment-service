# Assignment Service

Микросервис для автоматического назначения ревьюверов на Pull Request'ы.

## Технологический стек

- **Язык**: Go 1.22
- **База данных**: MongoDB 7.0
- **HTTP роутер**: Gorilla Mux
- **Логирование**: Uber Zap
- **Тестирование**: Go testing + testify
- **Контейнеризация**: Docker + Docker Compose

## Быстрый старт

### Запуск через Docker Compose

```bash
# Запуск всех сервисов
docker-compose up

## Удобные команды через make (остальные команды можно узнать через make help)
# Остановка и очистка
make docker-clean
# Запуск
make docker-up
```

Сервис будет доступен на `http://localhost:8080`

**Примечание:** Если у вас уже запущен локальный MongoDB на порту 27017, Docker Compose автоматически использует порт 27018 для внешнего доступа. Внутри Docker сети контейнеры общаются по стандартному порту 27017.


### Локальный запуск

```bash
# Установка зависимостей
make deps

# Сборка и запуск
make run

# Или просто:
go run ./cmd/server
```

## Makefile

Основные команды (make help):

- `build`             Собрать бинарник
- `run`               Запустить приложение локально
- `test`              Запустить тесты с race detector
- `test-coverage`     Показать покрытие тестами
- `lint`               Проверить код golangci-lint
- `fmt`                Отформатировать код (go fmt + goimports)
- `verify`             Полная проверка: формат + линтер + тесты
- `clean`              Удалить бинарники и coverage
- `deps`               Скачать и почистить зависимости
- `docker-build`       Собрать Docker-образы
- `docker-up`          Запустить сервисы
- `docker-up-detached` Запустить сервисы (в фоне)
- `docker-down`        Остановить и удалить контейнеры
- `docker-clean`       Полная очистка: контейнеры + volumes + образы
- `docker-logs`        Следить за логами контейнеров
- `help`               Показать эту справку

## API Эндпоинты

### Основные эндпоинты (описаны в OpenAPI)

- `POST /team/add` - создание команды
- `GET /team/get` - получение информации о команде
- `POST /users/setIsActive` - установка активности пользователя
- `GET /users/getReview` - получение PR на ревью
- `POST /pullRequest/create` - создание Pull Request
- `POST /pullRequest/merge` - слияние Pull Request
- `POST /pullRequest/reassign` - переназначение ревьювера

### Дополнительно реализованные эндпоинты

- `GET /health` - проверка работоспособности сервиса (не описан в OpenAPI, только объявлен)
- `GET /stats/user` - статистика по пользователям

## Тестирование

Покрытие кода тестами: **87.5%**

```bash
# Запуск всех тестов
make test

# Просмотр покрытия
make test-coverage
```

Тесты проверяют все основные сценарии работы сервиса включая обработку ошибок и граничные случаи.

## Нагрузочное тестирование

Более подробно описаны в `scripts/k6/README.md`

Для нагрузочного тестирования используется **k6**. Тесты находятся в папке `scripts/k6/`:

Результаты тестирования сохраняются в:
- `scripts/k6/results/` - текстовые отчеты прямиком из терминала с запусками k6
- `scripts/k6/k6-results/YYYY-MM-DD/` - JSON результаты для анализа (локальная папка)
- `scripts/k6/parse_results.py` - скрипт для парсинга результатов

### Аппаратное обеспечение тестирования

Нагрузочное тестирование проводилось на следующем оборудовании:

**Основные характеристики:**
- **Процессор**: Intel i3-7020U (4 ядра) @ 2.3GHz
- **Оперативная память**: 8GB
- **ОС**: Arch Linux x86_64

## CI/CD

Проект настроен с GitHub Actions:

- **go-ci.yml** - сборка, тестирование и линтинг Go кода
- **docker-ci.yml** - сборка Docker образов


